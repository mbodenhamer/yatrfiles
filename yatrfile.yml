#-------------------------------------------------------------------------------
default: test

#-------------------------------------------------------------------------------
import:
  - modules/yatrdev.py

#-------------------------------------------------------------------------------
macros:
  docker_shell_cmd: >
    pip install yatr &&
    mkdir /root/.yatr &&
    yatr --install-bash-completions &&
    echo 'source /etc/bash_completion.d/yatr' >> /root/.bashrc &&
    yatr cache &&
    bash

#-------------------------------------------------------------------------------
tasks:
  test: python test.py
  
  #-----------------------------------------------------------------------------
  # Caching

  cache-yatrfiles:
    command: cache_all
    kwargs:
      path: yatrfiles
      urlbase: https://raw.githubusercontent.com/mbodenhamer/yatrfiles/master/yatrfiles
      verbose: True

  cache-modules:
    command: cache_all
    kwargs:
      path: modules
      urlbase: https://raw.githubusercontent.com/mbodenhamer/yatrfiles/master/modules
      glob: "*.py"
      verbose: True

  cache:
    - cache-yatrfiles
    - cache-modules

  #-----------------------------------------------------------------------------
  # Docker

  docker-shell: >
    docker run --rm -it -v {{CURDIR}}:/app
    mbodenhamer/python-dev bash -c "{{docker_shell_cmd}}"

#-------------------------------------------------------------------------------
