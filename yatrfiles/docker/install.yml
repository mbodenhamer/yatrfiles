# Yatrfile for installing a specific docker version from source

#-------------------------------------------------------------------------------
macros:
  docker_arch: x86_64
  docker_version: 17.06.2-ce

  docker_tmpdir: /tmp/install-docker
  docker_tarball: "docker-{{docker_version}}.tgz"
  docker_tarball_url: >
    https://download.docker.com/linux/static/stable/{{docker_arch}}/{{docker_tarball}}

#-------------------------------------------------------------------------------
tasks:
  install-docker-files:
    - "mkdir {{docker_tmpdir}}"
    - "curl -sSL -O {{docker_tarball_url}} -o {{docker_tmpdir}}/{{docker_tarball}}"
    - "cp {{docker_tarball_url}} {{docker_tmpdir}}/{{docker_tarball}}"
    - "tar zxf {{docker_tmpdir}}/{{docker_tarball}} -C {{docker_tmpdir}}"
    - "mv {{docker_tmpdir}}/docker/* /usr/bin/"
    - "rm -rf {{docker_tmpdir}}"

  start-docker-daemon: "/usr/bin/dockerd &"

  install-docker:
    - install-docker-files
    - start-docker-daemon

#-------------------------------------------------------------------------------
